# these 3 DCF Indicators describe the spatial impact of fishing activity

= Describing the spatial distribution of fishing activity =

== Summary ==

The EU Data Collection Framework (DCF) standardizes three indicators to analyse the fishing activity. They are summarised as follow:

 * DCF Indicator 5: Distribution of fishing activities. The spatial extent of fishing activity based on the total area of grids within which VMS records were obtained, each month; 

 * DCF Indicator 6: Aggregation of fishing activities. The extent to which fishing activity is aggregated based on the total area of grids within which 90% of VMS records were obtained, each month.

 * DCF Indicator 7: Areas not impacted by mobile bottom gears. The area of seabed that has not been impacted by mobile bottom fishing gears in the last year. Could be reported annually and would state the total proportion of the area by depth strata in each marine region.

== Method ==

These indicators aggregate the tacsat point data into a gridded data frame using the functions _mapGrid.r_ and _vmsGridCreate.r_ and therefore the resolution of the grid (cell size) must be defined.

*DCF 5* calculates the total area of a grid of cells with fishing activity which is above a minimum threshold of number of pings or number of fishing hours (if the tacsat data contains a field with time interval between two points called SI_INTV, then the threshold will be a minimal number of hours, otherwise it will be a minimal number of points). The area of each cell is calculated with the function _surface.r_ either via a fast and rough method using a trapezoid  approximation (option "Trapezoid"), either via a more precise but slow method using a Universal Transverse Mercator projection (option "UTM"). The first method is fine for big grids of small cell sizes, the second one is better for large cell sizes. This total fishing area is processed by month.

*DCF 6* also calculates the total area of a grid with fishing activity but keeps only the 90% of the points by discarding the outer 10% points (or any other specified percentage). It uses the function _tacsatMinimumConvexPolygon.r_ adapted from the _aspace_ library. This function draws a minimum convex polygon around the central points to keep. Then these points are gridded and the total area of the cells is calculated with the _surface.r_ function with the same optional methods as DCF 5. This total fishing area is processed by month.

*DCF 7* calculates the total area of a specified polygon not impacted by mobile bottom gear. It therefore needs that the tacsat data has been merged with the logbooks in order to have a gear code (or others) for each vms point. The indicator needs a list of gear code to include as mobile bottom gears (if empty, all the points will be included). The specified area to be processed is a polygon shapefile. This polygon (or group of polygons) is then clipped with the Europe polygon to be sure that the indicator won't include land in its area calculation. If no shapefile is defined, the area of the bounding box containing all the vms points will be considered. The result is the area of the polygon less the area of the grid where fishing activity occurs. The vms pings are gridded with an optional threshold in either minimal of fishing hours or minimal number of points (see DCF 5). The area of each grid cell is calculated with the _surface.r_ function (see DCF 5 or DCF 6).


= Functions =

The main functions are:
 * DCFIndicator5.r
 * DCFIndicator6.r
 * DCFIndicator7.r

To run these indicator functions, the following functions are needed:
 * mapGrid.r
 * vmsGridCreate.r
 * tacsatMinimumConvexPolygon.r
 * surface.r
 * clipPolygons.r


= Details =
{{{
# load the library
library(vmstools)

# load the tacsat data
data(tacsat)

# process the tacsat data:
# pointInHarbour.r
# filterTacsat.r
# intervalTacsat.r      # mandatory if we want the gridding based on a time threshold (minimal number of hours)
# ...

# DCF Indicator 5
DCFIndicator5(tacsat,                      # tacsat data
              minThreshold=0,              # threshold for defining the cell as "fishing", in hours if a ping interval has been calculated otherwise in number of points
              cellresX=0.05,               # grid cell size
              cellresY=0.05,               # grid cell size
              calcAreaMethod="Trapezoid",  # method for cell area calculation ("Trapezoid" or "UTM")
              plotMapTF=TRUE,              # plot the map
              exportTableName="")          # export the monthly areas in a csv file


# DCF Indicator 6
DCFIndicator6(tacsat,                      # tacsat data
              pctThreshold=90,             # percentage of aggregated points to include
              cellresX=0.05,               # grid cell size
              cellresY=0.05,               # grid cell size
              calcAreaMethod="Trapezoid",  # method for cell area calculation ("Trapezoid" or "UTM")
              plotMapTF=TRUE,              # plot the map
              exportTableName="")          # export the monthly areas in a csv file

# DCF Indicator 7
# this indicator needs a gear code (or similar) in the tacsat
# so the tacsat has to be merged with the eflalo

# load the eflalo data
data(eflalo2)

# merge eflalo and tacsat
tacsat   <- mergeEflalo2Tacsat(eflalo2,tacsat)
# add gear code
tacsat$LE_GEAR <- eflalo2$LE_GEAR[match(tacsat$FT_REF,eflalo2$FT_REF)]

# load the europe polygon
data(europa)

# run the indicator
DCFIndicator7(tacsat,                      # tacsat data
              mobileBottomGear="",         # list of mobile bottom gear codes to consider (exemple: c("TBB","OTB","PTB","DRB","DRH"))
              inShapeArea=shapeFileArea,   # path and name of the shapefile (without the .shp extention) whose area will be calculated
              cellresX=0.05,               # grid cell size 
              cellresY=0.05,               # grid cell size 
              calcAreaMethod="Trapezoid",  # method for cell area calculation ("Trapezoid" or "UTM")
              minThreshold=0,              # threshold for defining the cell as "fishing", in hours if a ping interval has been calculated otherwise in number of points
              plotMapTF=TRUE)              # plot the map